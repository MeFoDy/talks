/**
 * Core for Shower HTML presentation engine
 * @shower/core v3.0.0-2, https://github.com/shower/core
 * @copyright 2010–2020 Vadim Makeev, https://pepelsbey.net
 * @license MIT
 */
!function(){"use strict";const e=Symbol("EventTarget");class t{constructor(){this[e]=document.createElement("div")}addEventListener(...t){this[e].addEventListener(...t)}removeEventListener(...t){this[e].removeEventListener(...t)}dispatchEvent(t){return Object.defineProperties(t,{target:{value:this},currentTarget:{value:this}}),this[e].dispatchEvent(t)}}const s=e=>{history.pushState=(()=>{}),history.replaceState=(()=>{});try{e()}finally{delete history.pushState,delete history.replaceState}};var i={containerSelector:".shower",progressSelector:".progress",stepSelector:".next",fullModeClass:"full",listModeClass:"list",slideSelector:".slide",slideTitleSelector:"h2",activeSlideClass:"active",visitedSlideClass:"visited"};class n extends t{constructor(e,t){super(),this.element=e,this.options=t,this._isActive=!1,this.state={visitsCount:0,innerStepsCount:0}}get isActive(){return this._isActive}get isVisited(){return this.state.visitsCount>0}get id(){return this.element.id}get title(){const e=this.element.querySelector(this.options.slideTitleSelector);return e?e.innerText:""}activate(){this._isActive||(this._isActive=!0,this.state.visitsCount++,this.element.classList.add(this.options.activeSlideClass),this.dispatchEvent(new Event("activate")))}deactivate(){this._isActive&&(this._isActive=!1,this.element.classList.replace(this.options.activeSlideClass,this.options.visitedSlideClass),this.dispatchEvent(new Event("deactivate")))}}var a=e=>{const{container:t}=e,s=(()=>{const e=document.createElement("section");return e.className="region",e.setAttribute("role","region"),e.setAttribute("aria-live","assertive"),e.setAttribute("aria-relevant","all"),e.setAttribute("aria-label","Slide Content: Auto-updating"),e})();t.appendChild(s);e.addEventListener("modechange",()=>{e.isFullMode?t.setAttribute("role","application"):t.removeAttribute("role")}),e.addEventListener("slidechange",()=>{const t=e.activeSlide;t&&(s.innerHTML=t.element.innerHTML)})},r=e=>{e.container.addEventListener("keydown",t=>{t.defaultPrevented||(e=>-1!==e.tabIndex)(t.target)||((t=>{const s=!(t.ctrlKey||t.altKey||t.metaKey);switch(t.key.toUpperCase()){case"ENTER":if(t.metaKey&&e.isListMode){t.shiftKey&&(t.preventDefault(),e.first());break}t.preventDefault(),t.shiftKey?e.prev():e.next();break;case"PAGEUP":case"ARROWUP":case"ARROWLEFT":case"H":case"K":case"P":s&&(t.preventDefault(),e.prev(t.shiftKey));break;case"PAGEDOWN":case"ARROWDOWN":case"ARROWRIGHT":case"L":case"J":case"N":s&&(t.preventDefault(),e.next(t.shiftKey));break;case" ":s&&e.isFullMode&&(t.preventDefault(),t.shiftKey?e.prev():e.next());break;case"HOME":t.preventDefault(),e.first();break;case"END":t.preventDefault(),e.last()}})(t),(t=>{switch(t.key.toUpperCase()){case"ESCAPE":e.isFullMode&&(t.preventDefault(),e.exitFullMode());break;case"ENTER":t.metaKey&&e.isListMode&&(t.preventDefault(),e.enterFullMode());break;case"P":t.metaKey&&t.altKey&&e.isListMode&&(t.preventDefault(),e.enterFullMode());break;case"F5":t.shiftKey&&e.isListMode&&(t.preventDefault(),e.enterFullMode())}})(t))})},l=e=>{const t=()=>{const t=e.isFullMode?"?full":"",s=e.activeSlide,i=s?`#${s.id}`:"";return location.pathname+t+i},i=()=>{(()=>{const t=new URL(location).searchParams.has("full");s(()=>{t?e.enterFullMode():e.exitFullMode()})})(),(()=>{const t=location.hash.slice(1);if(!t)return;const i=e.slides.find(e=>e.id===t);i?s(()=>{i.activate()}):e.activeSlide||e.first()})()};e.addEventListener("modechange",()=>{history.replaceState(null,document.title,t())}),e.addEventListener("slidechange",()=>{history.pushState(null,document.title,t())}),e.addEventListener("start",i),window.addEventListener("popstate",i)},o=e=>{const{stepSelector:t,activeSlideClass:s}=e.options;let i,n;const a=()=>{i.forEach((e,t)=>{e.classList.toggle(s,t<n)})};e.addEventListener("slidechange",()=>{i=(()=>{const{element:s}=e.activeSlide;return[...s.querySelectorAll(t)]})(),n=(()=>i.filter(e=>e.classList.contains(s)).length)(),e.activeSlide.state.innerStepsCount=i.length}),e.addEventListener("next",t=>{!t.defaultPrevented&&t.cancelable&&(e.isListMode||n===i.length||(t.preventDefault(),n++,a()))}),e.addEventListener("prev",t=>{!t.defaultPrevented&&t.cancelable&&!e.isListMode&&n!==i.length&&n&&(t.preventDefault(),n--,a())})},d=e=>{const{container:t}=e,s=()=>{t.style.transform=e.isFullMode?`scale(${1/Math.max(t.offsetWidth/window.innerWidth,t.offsetHeight/window.innerHeight)})`:""};e.addEventListener("modechange",s),window.addEventListener("resize",s),window.addEventListener("load",s)};const c=["s","m","h"];var h=e=>{if(!e)return 0;const t=(e=>c.some(t=>e.includes(t)))(e)?(e=>c.map(t=>e.match(`(\\S+)${t}`)).map(e=>e&&e[1]))(e):(e=>`::${e}`.split(":").reverse())(e);let[s,i,n]=t.map(Number);return s+=60*i,s+=3600*n,Math.max(1e3*s,0)};var v=e=>{a(e),r(e),(e=>{const{progressSelector:t}=e.options,s=e.container.querySelector(t);if(!s)return;s.setAttribute("role","progressbar"),s.setAttribute("aria-valuemin",0),s.setAttribute("aria-valuemax",100);e.addEventListener("slidechange",()=>{const t=e.activeSlideIndex,{length:i}=e.slides,n=t/(i-1)*100;s.style.width=`${n}%`,s.setAttribute("aria-valuenow",n),s.setAttribute("aria-valuetext",`Slideshow progress: ${n}%`)})})(e),o(e),(e=>{let t;const s=()=>{if(clearTimeout(t),e.isListMode)return;const s=e.activeSlide,{visitsCount:i,innerStepsCount:n}=s.state;if(i>1)return;const a=h(s.element.dataset.timing);a&&(t=n?setInterval(()=>e.next(),a/(n+1)):setTimeout(()=>e.next(),a))};e.addEventListener("modechange",s),e.addEventListener("slidechange",s),e.container.addEventListener("keydown",e=>{e.defaultPrevented||clearTimeout(t)})})(e),(e=>{const{title:t}=document,s=()=>{if(e.isFullMode){const s=e.activeSlide.title;if(s)return void(document.title=`${s} — ${t}`)}document.title=t};e.addEventListener("modechange",s),e.addEventListener("slidechange",s)})(e),l(e),(e=>{const{container:t}=e,{fullModeClass:s,listModeClass:i}=e.options;e.addEventListener("modechange",()=>{if(e.isFullMode)return t.classList.remove(i),void t.classList.add(s);t.classList.remove(s),t.classList.add(i);const n=e.activeSlide;n&&n.element.scrollIntoView({block:"center"})}),e.addEventListener("slidechange",()=>{e.activeSlide.element.scrollIntoView({block:"nearest"})}),e.addEventListener("start",()=>{t.classList.contains(s)?e.enterFullMode():t.classList.add(i)})})(e),d(e)};const u=(e,t)=>{e.id||(e.id=t+1)};const p=new class extends t{constructor(e){super(),this._mode="list",this._isStarted=!1,this.options={...i,...e}}configure(e){Object.assign(this.options,e)}start(){if(this._isStarted)return;const{containerSelector:e}=this.options;if(this.container=document.querySelector(e),!this.container)throw new Error(`Shower container with selector '${e}' not found.`);this._isStarted=!0,this._initSlides(),this.addEventListener("modechange",()=>{this.isFullMode&&!this.activeSlide&&this.first()}),v(this),this.dispatchEvent(new Event("start"))}_initSlides(){const e=[...this.container.querySelectorAll(this.options.slideSelector)].filter(e=>!e.hidden);e.forEach(u),this.slides=e.map(e=>{const t=new n(e,this.options);return t.addEventListener("activate",()=>{this._changeActiveSlide(t)}),t.element.addEventListener("click",()=>{this.isListMode&&(this.enterFullMode(),t.activate())}),t})}_changeActiveSlide(e){const t=this.slides.find(t=>t.isActive&&t!==e);t&&t.deactivate();const s=new CustomEvent("slidechange",{detail:{prev:t}});this.dispatchEvent(s)}get isFullMode(){return"full"===this._mode}get isListMode(){return"list"===this._mode}get activeSlide(){return this.slides.find(e=>e.isActive)}get activeSlideIndex(){return this.slides.findIndex(e=>e.isActive)}enterFullMode(){this.isFullMode||(this._mode="full",this.dispatchEvent(new Event("modechange")))}exitFullMode(){this.isListMode||(this._mode="list",this.dispatchEvent(new Event("modechange")))}goTo(e){const t=this.slides[e];t&&t.activate()}go(e){this.goTo(this.activeSlideIndex+e)}prev(e){const t=new Event("prev",{cancelable:!e});this.dispatchEvent(t)&&this.go(-1)}next(e){const t=new Event("next",{cancelable:!e});this.dispatchEvent(t)&&this.go(1)}first(){this.goTo(0)}last(){this.goTo(this.slides.length-1)}}(document.currentScript.dataset);var m;Object.defineProperty(window,"shower",{value:p,configurable:!0}),m=(()=>{p.start()}),document.currentScript.async?m():document.addEventListener("DOMContentLoaded",m)}();